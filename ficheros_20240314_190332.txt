### package.json
{
  "name": "lalibreriamagica",
  "private": true,
  "scripts": {
    "start": "meteor run",
    "test": "meteor test --once --driver-package meteortesting:mocha",
    "test-app": "TEST_WATCH=1 meteor test --full-app --driver-package meteortesting:mocha",
    "visualize": "meteor --production --extra-packages bundle-visualizer"
  },
  "dependencies": {
    "@babel/runtime": "^7.20.7",
    "@emotion/react": "^11.11.1",
    "@emotion/styled": "^11.11.0",
    "@fontsource/roboto": "^5.0.5",
    "@mui/icons-material": "^5.14.3",
    "@mui/material": "^5.14.5",
    "@mui/styled-engine-sc": "^5.12.0",
    "@mui/styles": "^5.14.6",
    "bcrypt": "^5.1.0",
    "meteor-node-stubs": "^1.2.5",
    "react": "^17.0.2",
    "react-dom": "^17.0.2",
    "react-router-dom": "^6.14.2",
    "styled-components": "^5.3.1"
  },
  "meteor": {
    "mainModule": {
      "client": "client/main.jsx",
      "server": "server/main.js"
    },
    "testModule": "tests/main.js"
  },
  "devDependencies": {
    "@babel/core": "^7.22.10"
  }
}


### README.me
Project with public code from my webpage to be analyzed by the plugin of ChatGPT AskCode


### todo.tasks
- sepparate social login functions to avoid error in facebook one
- Connect login with normal users FE with BE
- Add terms and conditions
- Manage success login
- Manage error login
- Create Routes
- Create signup component
x Implement continuar of login
x Create login for normal users
x Create login for google

### main.css
* {
  margin: 0;
  padding: 0;
}

### main.html
<head>
  <title>lalibreriamagica</title>
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=no"
  />
  <meta
    name="description"
    content="La web donde podrÃ¡s leer libros de forma gratuita de una forma mÃ¡gica con tus amigos."
  />
</head>

<body>
  <div id="react-target"></div>
</body>


### main.jsx
import React from "react";

import ReactDOM from "react-dom";
import { Meteor } from "meteor/meteor";
import { App } from "../imports/ui/App";

Meteor.startup(() => {
  const container = document.getElementById("react-target");
  ReactDOM.render(<App />, container);
});


### books.js
import { Mongo } from "meteor/mongo";

export const Bookmeteors = new Mongo.Collection("books");


### links.js
import { Mongo } from 'meteor/mongo';

export const LinksCollection = new Mongo.Collection('links');


### AppRoutes.jsx
import React from "react";
import { BrowserRouter, Routes, Route } from "react-router-dom";
import { useTracker } from "meteor/react-meteor-data";
import { Meteor } from "meteor/meteor";
import Header from "../ui/components/commons/Header";
import AuthenticatedHome from "../ui/pages/AuthenticatedHome"; // Componente para usuarios autenticados
import GuestHome from "../ui/pages/GuestHome"; // Componente para usuarios no autenticados
import Login from "../ui/user/Login";
import Register from "../ui/user/Register";
import NotFound from "../ui/pages/NotFound";
import ReadingRooms from "../ui/pages/ReadingRooms";

export const AppRoutes = () => {
  const userIsLoggedIn = useTracker(() => !!Meteor.userId());

  return (
    <BrowserRouter>
      {userIsLoggedIn && <Header />}{" "}
      {/* Mostrar el encabezado solo si el usuario estÃ¡ autenticado */}
      <Routes>
        <Route
          path="/"
          element={userIsLoggedIn ? <AuthenticatedHome /> : <GuestHome />}
        />
        {!userIsLoggedIn && <Route path="/login" element={<Login />} />}
        {!userIsLoggedIn && <Route path="/register" element={<Register />} />}
        <Route path="/reading-rooms" element={<ReadingRooms />} />
        <Route path="*" element={<NotFound />} />
      </Routes>
    </BrowserRouter>
  );
};


### App.jsx
import React from "react";
import { AppRoutes } from "../routes/AppRoutes";

export const App = () => (
  <div>
    <AppRoutes />
  </div>
);


### Info.jsx
import React from 'react';
import { useFind, useSubscribe } from 'meteor/react-meteor-data';
import { LinksCollection } from '../api/links';

export const Info = () => {
  const isLoading = useSubscribe('links');
  const links = useFind(() => LinksCollection.find());

  if(isLoading()) {
    return <div>Loading...</div>;
  }

  return (
    <div>
      <h2>Learn Meteor!</h2>
      <ul>{links.map(
        link => <li key={link._id}>
          <a href={link.url} target="_blank">{link.title}</a>
        </li>
      )}</ul>
    </div>
  );
};


### NetflixCarousel.jsx
import React from "react";
import { Card, CardMedia, CardContent, Typography } from "@mui/material";

const NetflixCarousel = () => {
  // Dummy data for Netflix-style carousel
  const books = [
    { title: "Harry Potter", image: "https://example.com/harry-potter.jpg" },
    {
      title: "Lord of the Rings",
      image: "https://example.com/lord-of-the-rings.jpg",
    },
    {
      title: "To Kill a Mockingbird",
      image: "https://example.com/to-kill-a-mockingbird.jpg",
    },
    { title: "1984", image: "https://example.com/1984.jpg" },
    {
      title: "Pride and Prejudice",
      image: "https://example.com/pride-and-prejudice.jpg",
    },
    {
      title: "The Great Gatsby",
      image: "https://example.com/the-great-gatsby.jpg",
    },
    { title: "Moby Dick", image: "https://example.com/moby-dick.jpg" },
    {
      title: "The Catcher in the Rye",
      image: "https://example.com/the-catcher-in-the-rye.jpg",
    },
    {
      title: "Brave New World",
      image: "https://example.com/brave-new-world.jpg",
    },
    { title: "Animal Farm", image: "https://example.com/animal-farm.jpg" },
  ];

  return (
    <div className="netflix-carousel">
      {books.map((book, index) => (
        <Card key={index} className="netflix-card">
          <CardMedia
            component="img"
            alt={book.title}
            height="140"
            image={book.image}
          />
          <CardContent>
            <Typography variant="body2" color="text.secondary">
              {book.title}
            </Typography>
          </CardContent>
        </Card>
      ))}
    </div>
  );
};

export default NetflixCarousel;


### Header.jsx
import React from "react";
import {
  SwipeableDrawer,
  List,
  ListItem,
  ListItemIcon,
  ListItemText,
  IconButton,
  AppBar,
  Toolbar,
  Typography,
  Divider,
} from "@mui/material";
import MenuIcon from "@mui/icons-material/Menu";
import HomeIcon from "@mui/icons-material/Home";
import LibraryBooksIcon from "@mui/icons-material/LibraryBooks";
import AccountCircleIcon from "@mui/icons-material/AccountCircle";
import GroupIcon from "@mui/icons-material/Group";
import NotificationsIcon from "@mui/icons-material/Notifications";
import AddBoxIcon from "@mui/icons-material/AddBox";
import ExitToAppIcon from "@mui/icons-material/ExitToApp";
import { Meteor } from "meteor/meteor";
import { useNavigate } from "react-router-dom";

export default function Header() {
  const [open, setOpen] = React.useState(false);
  const user = Meteor.user(); // Obtener el usuario actual
  const navigate = useNavigate();

  const handleDrawerOpen = () => {
    setOpen(true);
  };

  const handleDrawerClose = () => {
    setOpen(false);
  };

  const handleLogout = () => {
    Meteor.logout(); // Cerrar sesiÃ³n con Meteor
  };

  const iOS =
    typeof navigator !== "undefined" &&
    /iPad|iPhone|iPod/.test(navigator.userAgent);

  return (
    <div>
      <AppBar position="static">
        <Toolbar>
          <IconButton
            edge="start"
            color="inherit"
            aria-label="menu"
            onClick={handleDrawerOpen}
          >
            <MenuIcon />
          </IconButton>
          <Typography variant="h6">La LibrerÃ­a MÃ¡gica</Typography>
        </Toolbar>
      </AppBar>
      <SwipeableDrawer
        anchor="left"
        open={open}
        onClose={handleDrawerClose}
        onOpen={handleDrawerOpen}
      >
        <List>
          <ListItem button>
            <ListItemIcon>
              <HomeIcon />
            </ListItemIcon>
            <ListItemText primary="Inicio" />
          </ListItem>
          <ListItem button onClick={() => navigate("/reading-rooms")}>
            <ListItemIcon>
              <LibraryBooksIcon />
            </ListItemIcon>
            <ListItemText primary="Salas de Lectura" />
          </ListItem>
          <ListItem button>
            <ListItemIcon>
              <AddBoxIcon />
            </ListItemIcon>
            <ListItemText primary="Crear Sala" />
          </ListItem>
          <ListItem button>
            <ListItemIcon>
              <AccountCircleIcon />
            </ListItemIcon>
            <ListItemText primary="Perfil" />
          </ListItem>
          <ListItem button>
            <ListItemIcon>
              <GroupIcon />
            </ListItemIcon>
            <ListItemText primary="Amigos" />
          </ListItem>
          <ListItem button>
            <ListItemIcon>
              <NotificationsIcon />
            </ListItemIcon>
            <ListItemText primary="Notificaciones" />
          </ListItem>
        </List>
        {user && (
          <div style={{ marginTop: "auto" }}>
            <Divider />
            <ListItem button onClick={handleLogout}>
              <ListItemIcon>
                <ExitToAppIcon />
              </ListItemIcon>
              <ListItemText primary="Cerrar SesiÃ³n" />
            </ListItem>
          </div>
        )}
      </SwipeableDrawer>
      {/* Resto del contenido */}
    </div>
  );
}


### Logo.jsx
import React from "react";
import { styled } from "@mui/system";

const LogoImg = styled("img")({
  width: "150px",
  height: "150px",
  objectFit: "contain",
  marginBottom: "20px",
});

const Logo = () => (
  <LogoImg src="/images/magic_book_home.jpg" alt="LibrerÃ­a MÃ¡gica" />
);

export default Logo;


### AuthenticatedHome.jsx
import React from "react";
import {
  Button,
  Container,
  Typography,
  useTheme,
  Grid,
  Card,
  CardMedia,
  CardContent,
} from "@mui/material";
import { styled } from "@mui/system";

import NetflixCarousel from "../components/NetflixCarousel";
// Dummy data for Netflix-style carousel
const carouselBooks = [
  { id: 1, title: "Harry Potter", cover: "https://via.placeholder.com/150" },
  {
    id: 2,
    title: "El SeÃ±or de los Anillos",
    cover: "https://via.placeholder.com/150",
  },
  { id: 3, title: "La Odisea", cover: "https://via.placeholder.com/150" },
  { id: 4, title: "La Iliada", cover: "https://via.placeholder.com/150" },
  { id: 5, title: "Don Quijote", cover: "https://via.placeholder.com/150" },
  { id: 6, title: "Divergente", cover: "https://via.placeholder.com/150" },
  {
    id: 7,
    title: "Charlie y la Fabrica de Chocolate",
    cover: "https://via.placeholder.com/150",
  },
  // ... more books for the carousel
  // TODO: Insert Netflix-style carousel here
];
const books = [
  { id: 1, title: "Harry Potter", cover: "https://via.placeholder.com/150" },
  {
    id: 2,
    title: "El SeÃ±or de los Anillos",
    cover: "https://via.placeholder.com/150",
  },
  { id: 3, title: "1984", cover: "https://via.placeholder.com/150" },
  // ... mÃ¡s libros
];

const AuthenticatedHome = () => {
  const theme = useTheme();

  const AuthenticatedHomeContainer = styled(Container)`
    text-align: center;
    padding: ${theme.spacing(4)}px;
    background-color: ${theme.palette.background.paper};
    border-radius: ${theme.shape.borderRadius}px;
  `;

  const IntroText = styled(Typography)`
    font-size: 1.4em;
    margin: ${theme.spacing(3, 0)}px;
    color: ${theme.palette.text.primary};
  `;

  const ActionSection = styled("div")`
    margin: ${theme.spacing(3, 0)}px;
  `;

  const CreateRoomBtn = styled(Button)`
    background-color: ${theme.palette.primary.main};
    color: ${theme.palette.common.white};
    padding: ${theme.spacing(1, 2)}px;
    border-radius: ${theme.shape.borderRadius}px;
    &:hover {
      background-color: ${theme.palette.primary.dark};
    }
  `;

  const BookCard = styled(Card)`
    max-width: 220px;
    box-shadow: ${theme.shadows[5]};
  `;

  const BookCover = styled(CardMedia)`
    height: 300px;
  `;

  return (
    <AuthenticatedHomeContainer>
      <Typography variant="h4" component="h1">
        Bienvenido a La LibrerÃ­a MÃ¡gica ðŸ“šâœ¨
      </Typography>
      <IntroText>
        Descubre un mundo lleno de aventuras, misterios y conocimientos. Â¡Invita
        a tus amigos y compartan juntos la magia de la lectura!
      </IntroText>
      <ActionSection>
        <CreateRoomBtn>Crear Sala de Lectura</CreateRoomBtn>
      </ActionSection>
      <NetflixCarousel />
    </AuthenticatedHomeContainer>
  );
};

export default AuthenticatedHome;


### GuestHome.jsx
import React from "react";
import { Container, Button, Typography, Box } from "@mui/material";
import { styled } from "@mui/system";
import { useTheme } from "@mui/material/styles";
import { useNavigate } from "react-router-dom";

const ImageContainer = styled("div")({
  display: "flex",
  justifyContent: "center",
  width: "100%",
  paddingBottom: "20px",
});

const Image = styled("img")(({ theme }) => ({
  width: "60%",
  maxWidth: "600px",
  height: "auto",
  [theme.breakpoints.up("md")]: {
    width: "30%",
  },
}));

const ContentContainer = styled("div")({
  display: "flex",
  flexDirection: "column",
  alignItems: "center",
  gap: "20px",
});

const StyledButton = styled(Button)(({ theme }) => ({
  margin: "10px",
  width: "80%",
  [theme.breakpoints.up("md")]: {
    width: "auto",
  },
}));

const GuessHome = () => {
  const theme = useTheme();
  const navigate = useNavigate();

  return (
    <Container
      sx={{
        display: "flex",
        flexDirection: "column",
        alignItems: "center",
        justifyContent: "center",
        minHeight: "90vh",
        backgroundColor: "#f0f0f0",
        padding: "20px",
        boxSizing: "border-box",
      }}
    >
      <ImageContainer>
        <Image src="/images/magic_book_home.jpg" alt="Libro mÃ¡gico" />
      </ImageContainer>

      <ContentContainer>
        <Typography variant="h4" component="div" align="center">
          Â¡Bienvenido a la LibrerÃ­a MÃ¡gica!
        </Typography>

        <Box
          sx={{
            display: "flex",
            flexDirection: "row",
            justifyContent: "center",
            width: "100%",
            gap: 2,
            flexWrap: "wrap",
          }}
        >
          <StyledButton
            variant="contained"
            onClick={() => {
              /* Redireccionar a login */
              navigate("/login");
            }}
          >
            Iniciar sesiÃ³n
          </StyledButton>

          <StyledButton
            variant="contained"
            onClick={() => {
              /* Redireccionar a sign up */
              navigate("/register");
            }}
          >
            RegÃ­strate
          </StyledButton>
        </Box>
      </ContentContainer>
    </Container>
  );
};

export default GuessHome;

### NotFound.jsx
import React from "react";
import { Container, Typography, Box, Button } from "@mui/material";
import { styled } from "@mui/system";
import Logo from "../components/commons/Logo";

const StyledContainer = styled(Container)(({ theme }) => ({
  display: "flex",
  flexDirection: "column",
  alignItems: "center",
  justifyContent: "center",
  minHeight: "90vh",
  padding: theme.spacing(2),
  backgroundColor: "#f0f0f0",
  color: "#fff",
}));

const NotFound = () => {
  return (
    <StyledContainer maxWidth="xs">
      <Logo />
      <Typography component="h1" variant="h5" color="textPrimary">
        PÃ¡gina no encontrada
      </Typography>
      <Box mt={4} textAlign="center">
        <Typography variant="body2" color="textPrimary">
          Lo sentimos, la pÃ¡gina que estÃ¡s buscando no existe.
        </Typography>
      </Box>
      <Box mt={4}>
        <Button variant="contained" color="primary" href="/">
          Volver a inicio
        </Button>
      </Box>
    </StyledContainer>
  );
};

export default NotFound;


### ReadingRooms.jsx
import React from "react";
import {
  Card,
  CardContent,
  CardMedia,
  Typography,
  Divider,
} from "@mui/material";

const MY_ROOMS = [
  {
    id: 1,
    bookImage: "url_to_harry_potter_image.jpg",
    title: "Harry Potter",
    users: 5,
    currentPage: 75,
    totalPages: 400,
  },
  {
    id: 2,
    bookImage: "url_to_lotr_image.jpg",
    title: "Lord of the Rings",
    users: 8,
    currentPage: 50,
    totalPages: 1000,
  },
];

const PUBLIC_ROOMS = [
  {
    id: 3,
    bookImage: "url_to_mockingbird_image.jpg",
    title: "To Kill a Mockingbird",
    users: 12,
    currentPage: 20,
    totalPages: 324,
  },
  {
    id: 4,
    bookImage: "url_to_1984_image.jpg",
    title: "1984",
    users: 7,
    currentPage: 10,
    totalPages: 268,
  },
];

const ReadingRoomCard = ({
  bookImage,
  title,
  users,
  currentPage,
  totalPages,
}) => {
  return (
    <Card style={{ display: "flex", marginBottom: "16px" }}>
      <CardMedia
        component="img"
        image={bookImage}
        style={{ width: "33%", height: "150px" }}
      />
      <CardContent style={{ flex: "1" }}>
        <Typography variant="h6">{title}</Typography>
        <Typography variant="body2">ðŸ§‘â€ðŸ¤â€ðŸ§‘: {users}</Typography>
        <Typography variant="body1">
          PÃ¡gina: {currentPage}/{totalPages}
        </Typography>
      </CardContent>
    </Card>
  );
};

const ReadingRooms = () => {
  const myRooms = MY_ROOMS;
  const publicRooms = PUBLIC_ROOMS;
  return (
    <div>
      <Typography variant="h5">Mis Salas</Typography>
      <Divider style={{ marginBottom: "16px" }} />
      {myRooms.map((room) => (
        <ReadingRoomCard key={room.id} {...room} />
      ))}

      <Typography variant="h5" style={{ marginTop: "32px" }}>
        Salas PÃºblicas
      </Typography>
      <Divider style={{ marginBottom: "16px" }} />
      {publicRooms.map((room) => (
        <ReadingRoomCard key={room.id} {...room} />
      ))}
    </div>
  );
};

export default ReadingRooms;


### Login.jsx
import React, { useState } from "react";
import { Meteor } from "meteor/meteor";
import { useNavigate } from "react-router-dom";
import { IconButton, InputAdornment, Alert } from "@mui/material";
import Visibility from "@mui/icons-material/Visibility";
import VisibilityOff from "@mui/icons-material/VisibilityOff";
import EditIcon from "@mui/icons-material/Edit";
import {
  Button,
  TextField,
  Container,
  Typography,
  Box,
  Link,
} from "@mui/material";
import {
  Google as GoogleIcon,
  Facebook as FacebookIcon,
} from "@mui/icons-material";
import { styled } from "@mui/system";
import Logo from "../components/commons/Logo";

const StyledContainer = styled(Container)(({ theme }) => ({
  display: "flex",
  flexDirection: "column",
  alignItems: "center",
  justifyContent: "center",
  minHeight: "90vh",
  padding: theme.spacing(2),
  backgroundColor: "#f0f0f0",
  color: "#fff",
}));

const LoginForm = styled("form")({
  width: "100%",
  marginTop: "20px",
});

const SocialButton = styled(Button)(({ theme }) => ({
  marginTop: theme.spacing(1),
}));

const Login = () => {
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [step, setStep] = useState("email");
  const [emailError, setEmailError] = useState(false);
  const [showPassword, setShowPassword] = useState(false);
  const [loginError, setLoginError] = useState(null); // Agrega esta lÃ­nea

  const navigate = useNavigate();

  const validateEmail = (email) => {
    return /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(email);
  };

  const handleEmailChange = (e) => {
    setEmail(e.target.value);
    setEmailError(false);
  };

  const handlePasswordChange = (e) => {
    setPassword(e.target.value);
  };

  const handleLogin = (e) => {
    e.preventDefault();
    if (!validateEmail(email)) {
      setEmailError(true);
      return;
    }
    if (step === "password") {
      Meteor.loginWithPassword(email, password, (err) => {
        if (err) {
          setLoginError(`Login failed: ${err.message}`); // Modifica esta lÃ­nea
        } else {
          // Redirigir al usuario a la pÃ¡gina principal
          navigate("/");
        }
      });
    } else {
      setStep("password");
    }
  };

  const handleEditEmail = () => {
    setStep("email");
  };

  const handlePasswordToggle = () => {
    setShowPassword(!showPassword);
  };

  const handleFacebookLogin = () => {
    Meteor.loginWithFacebook(
      { requestPermissions: ["public_profile"] },
      (err) => {
        if (err) {
          setLoginError(`Facebook Login failed: ${err.message}`); // Modifica esta lÃ­nea
        } else {
          navigate("/");
        }
      }
    );
  };

  const handleGoogleLogin = () => {
    Meteor.loginWithGoogle((err) => {
      if (err) {
        setLoginError(`Google Login failed: ${err.message}`); // Modifica esta lÃ­nea
      } else {
        navigate("/");
      }
    });
  };

  return (
    <StyledContainer maxWidth="xs">
      <Logo />
      <Typography component="h1" variant="h5" color="textPrimary">
        {step === "email" ? "Bienvenido de nuevo" : "Introduce tu contraseÃ±a"}
      </Typography>
      {loginError && <Alert severity="error">{loginError}</Alert>}
      <LoginForm noValidate onSubmit={handleLogin}>
        <TextField
          variant="outlined"
          margin="normal"
          required
          fullWidth
          id="email"
          label="DirecciÃ³n de correo"
          name="email"
          autoComplete="email"
          autoFocus
          value={email}
          onChange={handleEmailChange}
          error={emailError}
          helperText={emailError && "Por favor introduce un correo vÃ¡lido"}
          InputProps={{
            readOnly: step === "password",
            endAdornment: step === "password" && (
              <InputAdornment position="end">
                <IconButton edge="end" onClick={handleEditEmail}>
                  <EditIcon />
                </IconButton>
              </InputAdornment>
            ),
          }}
        />
        {step === "password" && (
          <TextField
            variant="outlined"
            margin="normal"
            required
            fullWidth
            id="password"
            label="ContraseÃ±a"
            type={showPassword ? "text" : "password"}
            name="password"
            value={password}
            onChange={handlePasswordChange}
            InputProps={{
              endAdornment: (
                <InputAdornment position="end">
                  <IconButton
                    edge="end"
                    aria-label="toggle password visibility"
                    onClick={handlePasswordToggle}
                  >
                    {showPassword ? <Visibility /> : <VisibilityOff />}
                  </IconButton>
                </InputAdornment>
              ),
            }}
          />
        )}
        {step === "password" && (
          <Box textAlign="left" marginTop={2}>
            <Link href="#" variant="body2">
              Â¿Has olvidado tu contraseÃ±a?
            </Link>
          </Box>
        )}
        <Button
          type="submit"
          fullWidth
          variant="contained"
          color="primary"
          sx={{ mt: 3, mb: 1 }}
        >
          Continuar
        </Button>
        <Box
          textAlign="center"
          marginTop={1}
          sx={{ display: "flex", justifyContent: "center" }}
        >
          <Typography variant="body2" color="textPrimary" sx={{ mr: 1 }}>
            Â¿No tienes cuenta?
          </Typography>
          <Link href="/register" variant="body2">
            RegÃ­strate
          </Link>
        </Box>
        {step === "email" && (
          <>
            <Typography
              variant="body1"
              align="center"
              color="textPrimary"
              sx={{ mt: 1 }}
            >
              {" "}
              O
            </Typography>
            <SocialButton
              variant="outlined"
              startIcon={<FacebookIcon />}
              fullWidth
              onClick={handleFacebookLogin}
            >
              Continuar con Facebook
            </SocialButton>
            <SocialButton
              variant="outlined"
              startIcon={<GoogleIcon />}
              fullWidth
              onClick={handleGoogleLogin}
            >
              Continuar con Google
            </SocialButton>
          </>
        )}
      </LoginForm>
    </StyledContainer>
  );
};

export default Login;


### Register.jsx
import React, { useState } from "react";
import { Meteor } from "meteor/meteor";
import { IconButton, InputAdornment } from "@mui/material";
import { useNavigate } from "react-router-dom";
import EditIcon from "@mui/icons-material/Edit";
import Visibility from "@mui/icons-material/Visibility";
import VisibilityOff from "@mui/icons-material/VisibilityOff";
import {
  Button,
  TextField,
  Container,
  Typography,
  Box,
  Link,
} from "@mui/material";
import {
  Google as GoogleIcon,
  Facebook as FacebookIcon,
} from "@mui/icons-material";
import { styled } from "@mui/system";
import Logo from "../components/commons/Logo";

const StyledContainer = styled(Container)(({ theme }) => ({
  display: "flex",
  flexDirection: "column",
  alignItems: "center",
  justifyContent: "center",
  minHeight: "90vh",
  padding: theme.spacing(2),
  backgroundColor: "#f0f0f0",
  color: "#fff",
}));

const RegisterForm = styled("form")({
  width: "100%",
  marginTop: "20px",
});

const SocialButton = styled(Button)(({ theme }) => ({
  marginTop: theme.spacing(1),
}));

const Register = () => {
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [step, setStep] = useState("email");
  const [emailError, setEmailError] = useState(false);
  const [showPassword, setShowPassword] = useState(false);
  const navigate = useNavigate();

  const validateEmail = (email) => {
    return /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(email);
  };

  const handleEmailChange = (e) => {
    setEmail(e.target.value);
    setEmailError(false);
  };

  const handleEditEmail = () => {
    setStep("email");
  };

  const handlePasswordChange = (e) => {
    setPassword(e.target.value);
  };

  const handleRegister = (e) => {
    e.preventDefault();
    if (!validateEmail(email)) {
      setEmailError(true);
      return;
    }

    if (step === "password") {
      Accounts.createUser({ email, password }, (err) => {
        if (err) {
          alert(err.reason);
        } else {
          navigate("/");
        }
      });
    } else {
      setStep("password");
    }
  };

  const handlePasswordToggle = () => {
    setShowPassword(!showPassword);
  };

  const handleFacebookLogin = () => {
    Meteor.loginWithFacebook(
      { requestPermissions: ["public_profile"] },
      (err) => {
        if (err) {
          alert(`Facebook login fails`);
        } else {
          navigate("/");
        }
      }
    );
  };

  const handleGoogleLogin = () => {
    Meteor.loginWithGoogle((err) => {
      if (err) {
        alert(`Google login fails`);
      } else {
        navigate("/");
      }
    });
  };

  return (
    <StyledContainer maxWidth="xs">
      <Logo />
      <Typography component="h1" variant="h5" color="textPrimary">
        {step === "email" ? "Registra tu cuenta" : "Registra tu cuenta"}
      </Typography>
      <RegisterForm noValidate onSubmit={handleRegister}>
        <TextField
          variant="outlined"
          margin="normal"
          required
          fullWidth
          id="email"
          label="DirecciÃ³n de correo"
          name="email"
          autoComplete="email"
          autoFocus
          value={email}
          onChange={handleEmailChange}
          error={emailError}
          helperText={emailError && "Por favor introduce un correo vÃ¡lido"}
          InputProps={{
            readOnly: step === "password",
            endAdornment: step === "password" && (
              <InputAdornment position="end">
                <IconButton edge="end" onClick={handleEditEmail}>
                  <EditIcon />
                </IconButton>
              </InputAdornment>
            ),
          }}
        />
        {step === "password" && (
          <TextField
            variant="outlined"
            margin="normal"
            required
            fullWidth
            id="password"
            label="ContraseÃ±a"
            type={showPassword ? "text" : "password"}
            name="password"
            value={password}
            onChange={handlePasswordChange}
            InputProps={{
              endAdornment: (
                <InputAdornment position="end">
                  <IconButton
                    edge="end"
                    aria-label="toggle password visibility"
                    onClick={handlePasswordToggle}
                  >
                    {showPassword ? <Visibility /> : <VisibilityOff />}
                  </IconButton>
                </InputAdornment>
              ),
            }}
          />
        )}
        <Button
          type="submit"
          fullWidth
          variant="contained"
          color="primary"
          sx={{ mt: 3, mb: 1 }}
        >
          Continuar
        </Button>
        <Box
          textAlign="center"
          marginTop={1}
          sx={{ display: "flex", justifyContent: "center" }}
        >
          <Typography variant="body2" color="textPrimary" sx={{ mr: 1 }}>
            Â¿Ya tienes cuenta?
          </Typography>
          <Link href="/login" variant="body2">
            Inicia sesiÃ³n
          </Link>
        </Box>
        {step === "email" && (
          <>
            <Typography
              variant="body1"
              align="center"
              color="textPrimary"
              sx={{ mt: 1 }}
            >
              {" "}
              O
            </Typography>
            <SocialButton
              variant="outlined"
              startIcon={<FacebookIcon />}
              fullWidth
              onClick={handleFacebookLogin}
            >
              Continuar con Facebook
            </SocialButton>
            <SocialButton
              variant="outlined"
              startIcon={<GoogleIcon />}
              fullWidth
              onClick={handleGoogleLogin}
            >
              Continuar con Google
            </SocialButton>
          </>
        )}
      </RegisterForm>
    </StyledContainer>
  );
};

export default Register;


### main.js
import { ServiceConfiguration } from "meteor/service-configuration";

Meteor.startup(() => {
  // ConfiguraciÃ³n para Google
  ServiceConfiguration.configurations.upsert(
    { service: "google" },
    {
      $set: {
        clientId: process.env.GOOGLE_CLIENT_ID,
        secret: process.env.GOOGLE_SECRET,
        loginStyle: "popup",
      },
    }
  );

  // ConfiguraciÃ³n para Facebook
  ServiceConfiguration.configurations.upsert(
    { service: "facebook" },
    {
      $set: {
        appId: process.env.FACEBOOK_APP_ID,
        secret: process.env.FACEBOOK_SECRET,
        loginStyle: "popup",
      },
    }
  );
});


### main.js
import assert from "assert";

describe("lalibreriamagica", function () {
  it("package.json has correct name", async function () {
    const { name } = await import("../package.json");
    assert.strictEqual(name, "lalibreriamagica");
  });

  if (Meteor.isClient) {
    it("client is not server", function () {
      assert.strictEqual(Meteor.isServer, false);
    });
  }

  if (Meteor.isServer) {
    it("server is not client", function () {
      assert.strictEqual(Meteor.isClient, false);
    });
  }
});


